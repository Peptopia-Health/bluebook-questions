<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Klimek Guide</title>
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        html, body { margin: 0; padding: 0; min-height: 100vh; min-height: 100dvh; background: #b8aad0; }
        html.dark, html.dark body { background: #0f172a; }
    </style>
</head>
<body>
<script>
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(event) {
    if (event.matches) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
});
</script>

<div id="peptopia-klimek-guide">
    <style>
        #peptopia-klimek-guide {
            --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-200: #e2e8f0;
            --slate-700: #334155; --slate-800: #1e293b; --slate-900: #0f172a; --white: #ffffff;
            --rose-500: #fb7185; --blue-500: #06b6d4; --purple-500: #8b5cf6;
            --emerald-500: #10b981; --pink-500: #ec4899; --amber-500: #d97706;
            --teal-500: #14b8a6; --indigo-500: #6366f1; --red-600: #dc2626;
            --orange-600: #ea580c; --gray-600: #4b5563;
            --rose-50: #fff1f2; --blue-50: #ecfeff; --purple-50: #f5f3ff;
            --emerald-50: #ecfdf5; --pink-50: #fdf2f8; --amber-50: #fffbeb;
            --teal-50: #f0fdfa; --indigo-50: #eef2ff; --red-50: #fef2f2;
            --orange-50: #fff7ed; --gray-50: #f9fafb;
            --rose-100: #ffe4e6; --blue-100: #cffafe; --purple-100: #ede9fe;
            --emerald-100: #d1fae5; --pink-100: #fce7f3; --amber-100: #fef3c7;
            --teal-100: #ccfbf1; --indigo-100: #e0e7ff; --red-100: #fee2e2;
            --orange-100: #ffedd5; --gray-100: #f3f4f6;
            --rose-800: #9f1239; --blue-800: #155e75; --purple-800: #5b21b6;
            --emerald-800: #065f46; --pink-800: #9d174d; --amber-800: #92400e;
            --teal-800: #115e59; --indigo-800: #3730a3; --red-800: #991b1b;
            --orange-800: #9a3412; --gray-800: #1f2937;
            --alert-bg: #fff7ed; --alert-border: #fdba74; --alert-text: #1e293b;
            --accent-gold: #f59e0b;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: transparent; color: var(--slate-900); line-height: 1.6;
            font-size: 16px; max-width: 76rem; margin: 0 auto; padding: 0.75rem;
            box-sizing: border-box; -webkit-text-size-adjust: 100%;
        }
        html.dark #peptopia-klimek-guide {
            --slate-50: #0f172a; --slate-100: #1e293b; --slate-200: #334155;
            --slate-700: #cbd5e1; --slate-800: #0f172a; --slate-900: #f1f5f9; --white: #1e293b;
            --rose-50: #1a0a0d; --blue-50: #0a1a1f; --purple-50: #0f0a1f;
            --emerald-50: #0a1a12; --pink-50: #1a0a14; --amber-50: #1a150a;
            --teal-50: #0a1a17; --indigo-50: #0a0e1f; --red-50: #1a0a0a;
            --orange-50: #1a110a; --gray-50: #111827;
            --rose-100: #2d1015; --blue-100: #0c2530; --purple-100: #1a1035;
            --emerald-100: #0c2518; --pink-100: #2d101c; --amber-100: #2d2010;
            --teal-100: #0c2520; --indigo-100: #141835; --red-100: #2d1010;
            --orange-100: #2d1810; --gray-100: #1f2937;
            --rose-800: #fda4af; --blue-800: #67e8f9; --purple-800: #c4b5fd;
            --emerald-800: #6ee7b7; --pink-800: #f9a8d4; --amber-800: #fcd34d;
            --teal-800: #5eead4; --indigo-800: #a5b4fc; --red-800: #fca5a5;
            --orange-800: #fdba74; --gray-800: #d1d5db;
            --alert-bg: #1a150a; --alert-border: #92400e; --alert-text: #f1f5f9;
            background-color: transparent; color: #f1f5f9;
        }
        #peptopia-klimek-guide * { box-sizing: border-box; }
        #peptopia-klimek-guide .highlight-term {
            background-color: #fef08a; color: #000; padding: 0.1rem 0.4rem;
            border-radius: 0.25rem; font-weight: 800; display: inline-block; margin-bottom: 2px;
        }
        html.dark #peptopia-klimek-guide .highlight-term { background-color: #fde68a; color: #1e1b4b; }
        #peptopia-klimek-guide .navbar {
            background: linear-gradient(135deg, #0a1628 0%, #0c2461 50%, #0a1628 100%);
            color: #fff; padding: 0.75rem 1rem; border-radius: 0.5rem; margin-bottom: 0.75rem;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 16px -2px rgba(10, 22, 40, 0.5), 0 0 20px rgba(30, 100, 255, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.25);
        }
        html.dark #peptopia-klimek-guide .navbar { background: linear-gradient(135deg, #020617 0%, #0c2461 50%, #020617 100%); border: 1px solid rgba(59, 130, 246, 0.3); }
        #peptopia-klimek-guide .nav-title { font-weight: 800; font-size: 1.3rem; display: flex; align-items: center; gap: 0.5rem; cursor: pointer; }
        #peptopia-klimek-guide .tabs-container {
            display: flex; flex-wrap: wrap; gap: 0.3rem; margin-bottom: 1rem;
            justify-content: center; overflow-x: auto; -webkit-overflow-scrolling: touch;
            padding-bottom: 0.35rem; scrollbar-width: thin;
        }
        #peptopia-klimek-guide .tabs-container::-webkit-scrollbar { height: 4px; }
        #peptopia-klimek-guide .tabs-container::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }
        #peptopia-klimek-guide .tab-btn {
            padding: 0.5rem 0.65rem; border-radius: 0.5rem; font-weight: 700;
            border: 2px solid transparent; cursor: pointer; transition: all 0.15s;
            font-size: 0.8rem; opacity: 0.85; text-align: center; white-space: nowrap; flex-shrink: 0;
        }
        #peptopia-klimek-guide .tab-btn:hover { opacity: 1; transform: translateY(-1px); }
        #peptopia-klimek-guide .tab-btn.active { opacity: 1; box-shadow: 0 2px 8px rgba(0,0,0,0.12); transform: translateY(1px); font-weight: 800; }
        #peptopia-klimek-guide #tab-cardio { background-color: var(--rose-100); color: var(--rose-800); }
        #peptopia-klimek-guide #tab-resp { background-color: var(--blue-100); color: var(--blue-800); }
        #peptopia-klimek-guide #tab-neuro { background-color: var(--purple-100); color: var(--purple-800); }
        #peptopia-klimek-guide #tab-gi { background-color: var(--emerald-100); color: var(--emerald-800); }
        #peptopia-klimek-guide #tab-obpeds { background-color: var(--pink-100); color: var(--pink-800); }
        #peptopia-klimek-guide #tab-endo { background-color: var(--amber-100); color: var(--amber-800); }
        #peptopia-klimek-guide #tab-musc { background-color: var(--teal-100); color: var(--teal-800); }
        #peptopia-klimek-guide #tab-psych { background-color: var(--indigo-100); color: var(--indigo-800); }
        #peptopia-klimek-guide #tab-hemonc { background-color: var(--red-100); color: var(--red-800); }
        #peptopia-klimek-guide #tab-integ { background-color: var(--orange-100); color: var(--orange-800); }
        #peptopia-klimek-guide #tab-pharm { background-color: var(--gray-100); color: var(--gray-800); }
        #peptopia-klimek-guide .section-header-bar {
            padding: 0.65rem 1rem; min-height: 44px; color: white;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 0.75rem; font-size: 1.15rem; font-weight: 800;
            margin-bottom: 1rem; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); gap: 0.5rem;
        }
        #peptopia-klimek-guide .header-btn {
            background-color: #312e81; color: white; border: 2px solid rgba(255,255,255,0.5);
            padding: 0.45rem 1rem; border-radius: 0.5rem; font-size: 0.9rem; font-weight: 700;
            cursor: pointer; transition: all 0.2s; white-space: nowrap; -webkit-tap-highlight-color: transparent;
        }
        #peptopia-klimek-guide .header-btn:hover { background-color: white; color: #312e81; transform: scale(1.02); }
        #peptopia-klimek-guide .header-btns { display: flex; gap: 0.4rem; flex-shrink: 0; }
        #peptopia-klimek-guide .card-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.92); z-index: 1999;
            align-items: flex-start; justify-content: center; padding: 0;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
        }
        #peptopia-klimek-guide .card-modal {
            background: var(--white); width: 100%; max-width: 560px; border-radius: 0;
            min-height: 100vh; min-height: 100dvh; display: flex; flex-direction: column;
        }
        @media (min-width: 640px) {
            #peptopia-klimek-guide .card-overlay { align-items: center; padding: 1.5rem; }
            #peptopia-klimek-guide .card-modal { border-radius: 1rem; min-height: auto; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); }
        }
        html.dark #peptopia-klimek-guide .card-modal { background: #1e293b; }
        #peptopia-klimek-guide .card-modal-header {
            padding: 0.75rem 1rem; color: white; font-weight: 800; font-size: 1rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        @media (min-width: 640px) { #peptopia-klimek-guide .card-modal-header { border-radius: 1rem 1rem 0 0; } }
        #peptopia-klimek-guide .card-modal-header .card-close-btn {
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer; padding: 0 0.25rem; line-height: 1;
        }
        #peptopia-klimek-guide .card-modal-body { padding: 1.25rem; flex-grow: 1; }
        #peptopia-klimek-guide .card-modal-body .card-topic { font-size: 1.35rem; font-weight: 800; margin-bottom: 1rem; color: var(--slate-900); }
        html.dark #peptopia-klimek-guide .card-modal-body .card-topic { color: #f1f5f9; }
        #peptopia-klimek-guide .card-modal-body .card-section { margin-bottom: 1rem; }
        #peptopia-klimek-guide .card-modal-body .card-label {
            font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1px;
            color: #64748b; font-weight: 800; margin-bottom: 0.3rem; display: block;
        }
        html.dark #peptopia-klimek-guide .card-modal-body .card-label { color: #94a3b8; }
        #peptopia-klimek-guide .card-modal-body .card-fact { font-size: 1.05rem; line-height: 1.5; color: var(--slate-900); }
        html.dark #peptopia-klimek-guide .card-modal-body .card-fact { color: #e2e8f0; }
        #peptopia-klimek-guide .card-modal-body .card-alert-box {
            background: #fff1f2; border-left: 5px solid #e11d48; padding: 0.75rem; border-radius: 0.25rem;
        }
        html.dark #peptopia-klimek-guide .card-modal-body .card-alert-box { background: #1c1012; border-left-color: #be123c; }
        #peptopia-klimek-guide .card-modal-body .card-alert-box .card-fact { font-size: 0.95rem; }
        #peptopia-klimek-guide .card-nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.75rem 1rem; border-top: 1px solid var(--slate-200); gap: 0.5rem;
        }
        html.dark #peptopia-klimek-guide .card-nav { border-top-color: #334155; }
        #peptopia-klimek-guide .card-nav-btn {
            background: #4f46e5; color: white; border: none; padding: 0.55rem 1.25rem;
            border-radius: 2rem; font-weight: 700; cursor: pointer; font-size: 0.9rem;
            transition: background 0.15s; -webkit-tap-highlight-color: transparent;
        }
        #peptopia-klimek-guide .card-nav-btn:hover { background: #4338ca; }
        #peptopia-klimek-guide .card-nav-btn:disabled { opacity: 0.35; cursor: default; }
        #peptopia-klimek-guide .card-counter { font-size: 0.85rem; font-weight: 700; color: #64748b; white-space: nowrap; }
        html.dark #peptopia-klimek-guide .card-counter { color: #94a3b8; }
        #peptopia-klimek-guide .description-box {
            padding: 0.75rem 1rem; background: var(--white); border: 2px solid var(--slate-200);
            border-radius: 0.5rem; border-left: 5px solid var(--slate-700);
            font-size: 0.95rem; color: var(--slate-900); font-weight: 500; margin-bottom: 1rem;
        }
        html.dark #peptopia-klimek-guide .description-box { background: #1e293b; border-color: #475569; border-left-color: #94a3b8; }
        #peptopia-klimek-guide .table-container {
            overflow-x: auto; -webkit-overflow-scrolling: touch; border: 2px solid #334155;
            border-radius: 0.75rem; background: var(--white); max-height: 500px; overflow-y: auto;
        }
        html.dark #peptopia-klimek-guide .table-container { background: #1e293b; border-color: #475569; }
        #peptopia-klimek-guide table { width: 100%; border-collapse: collapse; text-align: left; font-size: 0.85rem; }
        #peptopia-klimek-guide th {
            padding: 0.6rem 0.65rem; background-color: #f1f5f9; color: #0f172a;
            border-bottom: 2px solid #e2e8f0; position: sticky; top: 0; z-index: 5;
            font-weight: 800; font-size: 0.8rem; white-space: nowrap;
        }
        html.dark #peptopia-klimek-guide th { background-color: #334155; color: #f1f5f9; border-bottom-color: #475569; }
        #peptopia-klimek-guide td { padding: 0.6rem 0.65rem; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
        html.dark #peptopia-klimek-guide td { border-bottom-color: #334155; color: #e2e8f0; }
        #peptopia-klimek-guide tr:hover td { cursor: pointer; background-color: #f8fafc; }
        html.dark #peptopia-klimek-guide tr:hover td { background-color: #1e293b; }
        #peptopia-klimek-guide .topic-cell { font-weight: 800; white-space: nowrap; color: #000; vertical-align: top; }
        html.dark #peptopia-klimek-guide .topic-cell { color: #f1f5f9; }
        #peptopia-klimek-guide .topic-cell.cardio { background-color: var(--rose-50); }
        #peptopia-klimek-guide .topic-cell.resp { background-color: var(--blue-50); }
        #peptopia-klimek-guide .topic-cell.neuro { background-color: var(--purple-50); }
        #peptopia-klimek-guide .topic-cell.gi { background-color: var(--emerald-50); }
        #peptopia-klimek-guide .topic-cell.obpeds { background-color: var(--pink-50); }
        #peptopia-klimek-guide .topic-cell.endo { background-color: var(--amber-50); }
        #peptopia-klimek-guide .topic-cell.musc { background-color: var(--teal-50); }
        #peptopia-klimek-guide .topic-cell.psych { background-color: var(--indigo-50); }
        #peptopia-klimek-guide .topic-cell.hemonc { background-color: var(--red-50); }
        #peptopia-klimek-guide .topic-cell.integ { background-color: var(--orange-50); }
        #peptopia-klimek-guide .topic-cell.pharm { background-color: var(--gray-50); }
        #peptopia-klimek-guide .key-point-cell { color: #334155; font-style: normal; font-weight: 500; }
        html.dark #peptopia-klimek-guide .key-point-cell { color: #cbd5e1; }
        #peptopia-klimek-guide .alert-cell { color: #991b1b; background-color: #fef2f2; border-left: 3px solid #f87171; font-weight: 600; }
        html.dark #peptopia-klimek-guide .alert-cell { background-color: #1c1012; color: #fca5a5; border-left-color: #dc2626; }
        @media (max-width: 600px) {
            #peptopia-klimek-guide .table-container { max-height: none; }
            #peptopia-klimek-guide table, #peptopia-klimek-guide thead, #peptopia-klimek-guide tbody,
            #peptopia-klimek-guide th, #peptopia-klimek-guide td, #peptopia-klimek-guide tr { display: block; width: 100%; }
            #peptopia-klimek-guide thead { display: none; }
            #peptopia-klimek-guide tr { border-bottom: 2px solid #e2e8f0; padding: 0.6rem 0; margin-bottom: 0.35rem; }
            html.dark #peptopia-klimek-guide tr { border-bottom-color: #334155; }
            #peptopia-klimek-guide td { padding: 0.3rem 0.65rem; border-bottom: none; position: relative; padding-left: 0.65rem; }
            #peptopia-klimek-guide .topic-cell { font-size: 0.95rem; padding-bottom: 0.15rem; white-space: normal; }
            #peptopia-klimek-guide .key-point-cell::before { content: '\1F4CC '; }
            #peptopia-klimek-guide .alert-cell { border-left: 3px solid #f87171; margin: 0.2rem 0.3rem; border-radius: 0.25rem; padding: 0.4rem 0.6rem; font-size: 0.85rem; }
            #peptopia-klimek-guide .section-header-bar { font-size: 1rem; padding: 0.5rem 0.75rem; flex-wrap: wrap; }
            #peptopia-klimek-guide .nav-title { font-size: 1.15rem; }
        }
        #peptopia-klimek-guide .quiz-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.96); z-index: 2000;
            align-items: flex-start; justify-content: center; padding: 0;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
        }
        #peptopia-klimek-guide .quiz-box {
            background: #1e1b4b; width: 100%; max-width: 700px; padding: 1.25rem; border-radius: 0;
            border: none; color: white; display: flex; flex-direction: column;
            min-height: 100vh; min-height: 100dvh;
        }
        @media (min-width: 640px) {
            #peptopia-klimek-guide .quiz-overlay { align-items: center; padding: 1rem; }
            #peptopia-klimek-guide .quiz-box {
                border-radius: 1rem; min-height: auto; max-height: none;
                border: 1px solid #4338ca; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); padding: 1.75rem;
            }
        }
        #peptopia-klimek-guide .quiz-question-number {
            background: #4338ca; width: 36px; height: 36px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; margin-right: 0.75rem; flex-shrink: 0; font-size: 0.9rem;
        }
        #peptopia-klimek-guide .quiz-header-row { display: flex; align-items: flex-start; margin-bottom: 1.25rem; }
        #peptopia-klimek-guide .quiz-question-text { font-size: 1.1rem; line-height: 1.5; font-weight: 500; }
        #peptopia-klimek-guide .quiz-option {
            background: #312e81; border: 2px solid #4338ca; padding: 0.85rem; margin-bottom: 0.5rem;
            border-radius: 0.5rem; cursor: pointer; transition: all 0.15s; display: flex; align-items: center;
            font-size: 1rem; color: #e0e7ff; width: 100%; text-align: left;
            -webkit-tap-highlight-color: transparent; user-select: none;
        }
        #peptopia-klimek-guide .quiz-option:hover { background: #3730a3; border-color: #6366f1; }
        #peptopia-klimek-guide .quiz-option.correct-choice { background: #064e3b; border-color: #10b981; color: white; }
        #peptopia-klimek-guide .quiz-option.wrong-choice { background: #7f1d1d; border-color: #ef4444; color: white; opacity: 0.8; }
        #peptopia-klimek-guide .quiz-option-letter {
            background: rgba(255,255,255,0.1); width: 28px; height: 28px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            margin-right: 0.75rem; font-weight: 700; font-size: 0.85rem; flex-shrink: 0;
        }
        #peptopia-klimek-guide .feedback-container { margin-top: 1rem; background: #312e81; border-radius: 0.5rem; border: 1px solid #4338ca; }
        #peptopia-klimek-guide .feedback-container[style*="display: block"],
        #peptopia-klimek-guide .feedback-container.is-visible { display: block !important; }
        #peptopia-klimek-guide .feedback-header { padding: 0.6rem 0.85rem; font-weight: 800; display: flex; align-items: center; gap: 0.5rem; font-size: 1rem; }
        #peptopia-klimek-guide .feedback-header.correct { background: #065f46; color: #34d399; border-radius: 0.5rem 0.5rem 0 0; }
        #peptopia-klimek-guide .feedback-header.incorrect { background: #7f1d1d; color: #fca5a5; border-radius: 0.5rem 0.5rem 0 0; }
        #peptopia-klimek-guide .feedback-content { padding: 0.85rem; font-size: 0.95rem; line-height: 1.6; color: #e0e7ff; }
        #peptopia-klimek-guide .rationale-label { color: #a5b4fc; font-weight: 800; display: block; margin-bottom: 0.4rem; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }
        #peptopia-klimek-guide .quiz-footer { margin-top: 1.25rem; display: flex; justify-content: center; align-items: center; padding-bottom: env(safe-area-inset-bottom, 0.5rem); }
        #peptopia-klimek-guide .next-q-btn {
            background: #4f46e5; color: white; border: none; padding: 0.75rem 2.5rem;
            border-radius: 2rem; font-weight: 800; cursor: pointer;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4); font-size: 1rem;
            -webkit-tap-highlight-color: transparent; width: 100%; max-width: 320px;
        }
        #peptopia-klimek-guide .next-q-btn:hover { background: #4338ca; }
        #peptopia-klimek-guide .tab-btn.bg-rose { background-color: var(--rose-100) !important; color: var(--rose-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-blue { background-color: var(--blue-100) !important; color: var(--blue-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-purple { background-color: var(--purple-100) !important; color: var(--purple-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-emerald { background-color: var(--emerald-100) !important; color: var(--emerald-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-pink { background-color: var(--pink-100) !important; color: var(--pink-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-amber { background-color: var(--amber-100) !important; color: var(--amber-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-teal { background-color: var(--teal-100) !important; color: var(--teal-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-indigo { background-color: var(--indigo-100) !important; color: var(--indigo-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-red { background-color: var(--red-100) !important; color: var(--red-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-orange { background-color: var(--orange-100) !important; color: var(--orange-800) !important; }
        #peptopia-klimek-guide .tab-btn.bg-gray { background-color: var(--gray-100) !important; color: var(--gray-800) !important; }
        #peptopia-klimek-guide .bg-rose { background-color: var(--rose-500) !important; }
        #peptopia-klimek-guide .bg-blue { background-color: var(--blue-500) !important; }
        #peptopia-klimek-guide .bg-purple { background-color: var(--purple-500) !important; }
        #peptopia-klimek-guide .bg-emerald { background-color: var(--emerald-500) !important; }
        #peptopia-klimek-guide .bg-pink { background-color: var(--pink-500) !important; }
        #peptopia-klimek-guide .bg-amber { background-color: var(--amber-500) !important; }
        #peptopia-klimek-guide .bg-teal { background-color: var(--teal-500) !important; }
        #peptopia-klimek-guide .bg-indigo { background-color: var(--indigo-500) !important; }
        #peptopia-klimek-guide .bg-red { background-color: var(--red-600) !important; }
        #peptopia-klimek-guide .bg-orange { background-color: var(--orange-600) !important; }
        #peptopia-klimek-guide .bg-gray { background-color: var(--gray-600) !important; }
        #peptopia-klimek-guide .home-hero { text-align: center; padding: 0 0 0.5rem; }
        #peptopia-klimek-guide .home-hero-banner {
            background: linear-gradient(135deg, #0a1628 0%, #0c2461 50%, #0a1628 100%);
            color: rgba(255,255,255,0.92); padding: 0.75rem 1rem; border-radius: 0.5rem;
            font-size: 1rem; font-weight: 600; line-height: 1.5; margin-bottom: 0.75rem;
            box-shadow: 0 4px 16px -2px rgba(10, 22, 40, 0.5), 0 0 20px rgba(30, 100, 255, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.25);
        }
        html.dark #peptopia-klimek-guide .home-hero-banner {
            background: linear-gradient(135deg, #020617 0%, #0c2461 50%, #020617 100%);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        #peptopia-klimek-guide .home-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 0.75rem; margin-bottom: 2rem;
        }
        @media (max-width: 600px) { #peptopia-klimek-guide .home-grid { grid-template-columns: 1fr; } }
        #peptopia-klimek-guide .home-card {
            border-radius: 0.75rem; overflow: hidden; cursor: pointer;
            transition: transform 0.18s, box-shadow 0.18s; background: var(--white);
            border: 2px solid var(--slate-200); display: flex; flex-direction: column;
            animation: cardSlideUp 0.4s ease-out both;
        }
        html.dark #peptopia-klimek-guide .home-card { background: #1e293b; border-color: #334155; }
        #peptopia-klimek-guide .home-card:hover { transform: translateY(-3px); box-shadow: 0 8px 24px -4px rgba(0,0,0,0.15); }
        html.dark #peptopia-klimek-guide .home-card:hover { box-shadow: 0 8px 24px -4px rgba(0,0,0,0.4); }
        #peptopia-klimek-guide .home-card-header { padding: 0.7rem 0.85rem; font-weight: 800; font-size: 1rem; display: flex; align-items: center; gap: 0.5rem; }
        #peptopia-klimek-guide .home-card-header .home-card-emoji { font-size: 1.2rem; }
        #peptopia-klimek-guide .home-card-body { padding: 0.65rem 0.85rem 0.5rem; flex-grow: 1; }
        #peptopia-klimek-guide .home-card-desc { font-size: 0.82rem; color: #64748b; line-height: 1.45; margin-bottom: 0.5rem; }
        html.dark #peptopia-klimek-guide .home-card-desc { color: #94a3b8; }
        #peptopia-klimek-guide .home-card-meta { display: flex; gap: 0.75rem; align-items: center; font-size: 0.72rem; color: #94a3b8; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        #peptopia-klimek-guide .home-card-footer { padding: 0.5rem 0.85rem 0.65rem; border-top: 1px solid var(--slate-200); display: flex; gap: 0.4rem; }
        html.dark #peptopia-klimek-guide .home-card-footer { border-top-color: #334155; }
        #peptopia-klimek-guide .home-card-btn { font-size: 0.78rem; font-weight: 700; padding: 0.35rem 0.7rem; border-radius: 0.35rem; border: none; cursor: pointer; transition: all 0.15s; -webkit-tap-highlight-color: transparent; }
        #peptopia-klimek-guide .home-card-btn.study-btn { background: #eef2ff; color: #4338ca; }
        html.dark #peptopia-klimek-guide .home-card-btn.study-btn { background: #1e1b4b; color: #a5b4fc; }
        #peptopia-klimek-guide .home-card-btn.study-btn:hover { background: #c7d2fe; }
        html.dark #peptopia-klimek-guide .home-card-btn.study-btn:hover { background: #312e81; }
        #peptopia-klimek-guide .home-card-btn.quiz-btn { background: #312e81; color: white; }
        #peptopia-klimek-guide .home-card-btn.quiz-btn:hover { background: #4338ca; }
        #peptopia-klimek-guide .home-nav-btn {
            background: none; border: 1px solid rgba(255,255,255,0.4); color: rgba(255,255,255,0.9);
            padding: 0.3rem 0.65rem; border-radius: 0.35rem; font-size: 0.8rem; font-weight: 700;
            cursor: pointer; transition: all 0.15s; -webkit-tap-highlight-color: transparent; display: none;
        }
        #peptopia-klimek-guide .home-nav-btn:hover { background: rgba(255,255,255,0.15); border-color: rgba(255,255,255,0.7); }
        @keyframes cardSlideUp { from { opacity: 0; transform: translateY(18px); } to { opacity: 1; transform: translateY(0); } }
        #peptopia-klimek-guide .navbar-pdf-btn {
            background: #312e81; color: white; border: 2px solid rgba(255,255,255,0.5);
            padding: 0.3rem 0.65rem; border-radius: 0.35rem; font-size: 0.8rem; font-weight: 700;
            cursor: pointer; transition: all 0.15s; -webkit-tap-highlight-color: transparent; white-space: nowrap;
        }
        #peptopia-klimek-guide .navbar-pdf-btn:hover { background: white; color: #312e81; }
        #peptopia-klimek-guide .pdf-view {
            display: none; border-radius: 0.75rem; overflow: hidden;
            border: 2px solid var(--slate-200); height: calc(100vh - 130px); height: calc(100dvh - 130px);
        }
        html.dark #peptopia-klimek-guide .pdf-view { border-color: #334155; }
        #peptopia-klimek-guide .pdf-layout { display: flex; height: 100%; }
        #peptopia-klimek-guide .pdf-sidebar {
            width: 250px; min-width: 250px; background: linear-gradient(180deg, #0a1628 0%, #0c1e3d 100%);
            color: #e0e7ff; overflow-y: auto; border-right: 1px solid rgba(59, 130, 246, 0.25); padding: 0.5rem 0;
        }
        #peptopia-klimek-guide .pdf-sidebar-cat {
            padding: 0.6rem 0.85rem; font-weight: 800; font-size: 0.82rem; color: #818cf8;
            text-transform: uppercase; letter-spacing: 0.5px; display: flex; align-items: center;
            gap: 0.5rem; cursor: pointer; user-select: none;
        }
        #peptopia-klimek-guide .pdf-sidebar-cat:hover { background: rgba(255,255,255,0.05); }
        #peptopia-klimek-guide .pdf-sidebar-cat .cat-arrow { transition: transform 0.2s; display: inline-block; font-size: 0.7rem; }
        #peptopia-klimek-guide .pdf-sidebar-cat .cat-arrow.open { transform: rotate(90deg); }
        #peptopia-klimek-guide .pdf-sidebar-items { overflow: hidden; }
        #peptopia-klimek-guide .pdf-sidebar-item {
            padding: 0.5rem 0.85rem 0.5rem 1.6rem; font-size: 0.88rem; cursor: pointer;
            transition: background 0.15s; display: flex; align-items: center; gap: 0.5rem;
        }
        #peptopia-klimek-guide .pdf-sidebar-item:hover { background: rgba(99, 102, 241, 0.2); }
        #peptopia-klimek-guide .pdf-sidebar-item.active { background: rgba(99, 102, 241, 0.3); color: white; font-weight: 700; }
        #peptopia-klimek-guide .pdf-viewer-pane {
            flex: 1; display: flex; flex-direction: column; background: #1e1b4b; position: relative;
        }
        #peptopia-klimek-guide .pdf-canvas-wrap {
            flex: 1; overflow: auto; display: flex; justify-content: center;
            align-items: flex-start; padding: 1rem;
        }
        #peptopia-klimek-guide .pdf-canvas-wrap canvas { max-width: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.4); }
        #peptopia-klimek-guide .pdf-toolbar {
            display: flex; align-items: center; justify-content: center; gap: 0.5rem;
            padding: 0.6rem; background: #0f0e2a; border-top: 1px solid rgba(99, 102, 241, 0.3); flex-wrap: wrap;
        }
        #peptopia-klimek-guide .pdf-tb { background: #312e81; color: white; border: none; padding: 0.45rem 0.85rem; border-radius: 0.4rem; font-weight: 700; font-size: 0.85rem; cursor: pointer; transition: background 0.15s; }
        #peptopia-klimek-guide .pdf-tb:hover { background: #4338ca; }
        #peptopia-klimek-guide .pdf-tb:disabled { opacity: 0.4; cursor: default; }
        #peptopia-klimek-guide .pdf-tb.dl { background: #059669; }
        #peptopia-klimek-guide .pdf-tb.dl:hover { background: #047857; }
        #peptopia-klimek-guide .pdf-tb.cl { background: #dc2626; }
        #peptopia-klimek-guide .pdf-tb.cl:hover { background: #b91c1c; }
        #peptopia-klimek-guide .pdf-info { color: #a5b4fc; font-size: 0.85rem; font-weight: 700; white-space: nowrap; }
        #peptopia-klimek-guide .pdf-placeholder {
            flex: 1; display: flex; align-items: center; justify-content: center;
            color: #6366f1; font-size: 1.1rem; font-weight: 600; text-align: center; padding: 2rem;
        }
        #peptopia-klimek-guide .pdf-loading { color: #818cf8; font-size: 0.95rem; text-align: center; padding: 2rem; }
        @media (max-width: 768px) {
            #peptopia-klimek-guide .pdf-layout { flex-direction: column; }
            #peptopia-klimek-guide .pdf-sidebar { width: 100%; min-width: unset; max-height: 180px; border-right: none; border-bottom: 1px solid rgba(59,130,246,0.25); }
            #peptopia-klimek-guide .pdf-view { height: calc(100vh - 100px); height: calc(100dvh - 100px); }
            #peptopia-klimek-guide .navbar-pdf-btn { font-size: 0.72rem; padding: 0.25rem 0.5rem; }
        }
    </style>

    <nav class="navbar">
        <div class="nav-title" onclick="showHome()">Klimek Guide</div>
        <div style="display:flex; gap:0.4rem; align-items:center;">
            <button class="home-nav-btn" id="home-back-btn" onclick="showHome()">&#8592; Home</button>
            <button class="navbar-pdf-btn" id="pdf-nav-btn" onclick="showPDFs()">&#128196; Klimek PDFs</button>
        </div>
    </nav>

    <div class="tabs-container">
        <button class="tab-btn bg-rose" id="tab-cardio" onclick="switchTab('cardio')">Cardio</button>
        <button class="tab-btn bg-blue" id="tab-resp" onclick="switchTab('resp')">Resp</button>
        <button class="tab-btn bg-purple" id="tab-neuro" onclick="switchTab('neuro')">Neuro</button>
        <button class="tab-btn bg-emerald" id="tab-gi" onclick="switchTab('gi')">GI &amp; Nutr</button>
        <button class="tab-btn bg-pink" id="tab-obpeds" onclick="switchTab('obpeds')">OB &amp; Peds</button>
        <button class="tab-btn bg-amber" id="tab-endo" onclick="switchTab('endo')">Endocrine</button>
        <button class="tab-btn bg-teal" id="tab-musc" onclick="switchTab('musc')">Musculoskeletal</button>
        <button class="tab-btn bg-indigo" id="tab-psych" onclick="switchTab('psych')">Psych</button>
        <button class="tab-btn bg-red" id="tab-hemonc" onclick="switchTab('hemonc')">Heme/Onc</button>
        <button class="tab-btn bg-orange" id="tab-integ" onclick="switchTab('integ')">Integ/Sensory</button>
        <button class="tab-btn bg-gray" id="tab-pharm" onclick="switchTab('pharm')">Pharm</button>
    </div>

    <div id="home-dashboard">
        <div class="home-hero">
            <div class="home-hero-banner">Your comprehensive NCLEX review across 11 nursing specialties &mdash; study cards, facts &amp; 1,100 quiz questions.</div>
        </div>
        <div class="home-grid" id="home-grid"></div>
    </div>

    <div id="section-view" style="display:none;">
        <div id="desc-area" class="description-box"></div>
        <div id="content-area"></div>
    </div>

    <div id="quiz-modal" class="quiz-overlay">
        <div class="quiz-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;">
                <span style="color:#818cf8; font-weight:700;" id="quiz-progress">Question 1 of ?</span>
                <button onclick="closeQuiz()" style="background:none; border:none; color:#818cf8; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>
            <div class="quiz-header-row">
                <div class="quiz-question-number" id="q-num-display">1</div>
                <div class="quiz-question-text" id="q-text"></div>
            </div>
            <div id="q-options"></div>
            <div id="feedback-area" class="feedback-container">
                <div class="feedback-header" id="feedback-header"></div>
                <div class="feedback-content">
                    <span class="rationale-label">Rationale:</span>
                    <span id="rationale-text"></span>
                </div>
            </div>
            <div class="quiz-footer">
                <button class="next-q-btn" id="next-btn" style="display:none;" onclick="nextQuestion()">Next Question</button>
            </div>
        </div>
    </div>

    <div id="card-modal" class="card-overlay">
        <div class="card-modal">
            <div class="card-modal-header" id="card-modal-header">
                <span id="card-modal-title">Study Cards</span>
                <button class="card-close-btn" onclick="closeCards()">&times;</button>
            </div>
            <div class="card-modal-body" id="card-modal-body"></div>
            <div class="card-nav">
                <button class="card-nav-btn" id="card-prev-btn" onclick="prevCard()">&#8592; Prev</button>
                <span class="card-counter" id="card-counter">1 / ?</span>
                <button class="card-nav-btn" id="card-next-btn" onclick="nextCard()">Next &#8594;</button>
            </div>
        </div>
    </div>

    <div id="pdf-view" class="pdf-view">
        <div class="pdf-layout">
            <div class="pdf-sidebar" id="pdf-sidebar">
                <div class="pdf-loading">Loading PDF menu...</div>
            </div>
            <div class="pdf-viewer-pane">
                <div class="pdf-canvas-wrap" id="pdf-canvas-wrap">
                    <div class="pdf-placeholder" id="pdf-placeholder">Select a PDF from the menu to begin studying</div>
                    <canvas id="pdf-canvas" style="display:none;"></canvas>
                </div>
                <div class="pdf-toolbar" id="pdf-toolbar" style="display:none;">
                    <button class="pdf-tb" id="pdf-prev" onclick="pdfPrevPage()">&#9664; Prev</button>
                    <span class="pdf-info" id="pdf-page-info">Page 1 of 1</span>
                    <button class="pdf-tb" id="pdf-next" onclick="pdfNextPage()">Next &#9654;</button>
                    <button class="pdf-tb" onclick="pdfZoomOut()">&minus;</button>
                    <span class="pdf-info" id="pdf-zoom-info">100%</span>
                    <button class="pdf-tb" onclick="pdfZoomIn()">+</button>
                    <button class="pdf-tb dl" onclick="pdfDownload()">&#11015; Download</button>
                    <button class="pdf-tb cl" onclick="showHome()">&#10005; Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    (function() {
        var loadingEl = document.getElementById('home-dashboard');
        loadingEl.innerHTML = '<div style="text-align:center;padding:2rem;color:var(--slate-900);font-weight:600;">Loading study data...</div>';

        var GH_CDN = 'https://cdn.jsdelivr.net/gh/Peptopia-Health/bluebook-questions@main/';

        fetch(GH_CDN + 'mnt_studydata.js')
            .then(function(r) {
                if (!r.ok) throw new Error('HTTP ' + r.status);
                return r.text();
            })
            .then(function(text) {
                try {
                    var fn = new Function(text + '\n; return contentData;');
                    window.contentData = fn();
                } catch (e) {
                    throw new Error('Parse error: ' + e.message);
                }
                initApp();
            })
            .catch(function(err) {
                loadingEl.innerHTML =
                    '<div style="text-align:center;padding:2rem;color:#dc2626;font-weight:700;">' +
                    'Error: Study data failed to load.' +
                    '<br><small style="color:#94a3b8;font-weight:400;">' + err.message + '</small></div>';
            });

        function initApp() {
        loadingEl.innerHTML =
            '<div class="home-hero"><div class="home-hero-banner">Your comprehensive NCLEX review across 11 nursing specialties &mdash; study cards, facts &amp; 1,100 quiz questions.</div></div>' +
            '<div class="home-grid" id="home-grid"></div>';

        var sectionEmojis = {
            cardio: '\u2764\uFE0F', resp: '\uD83E\uDEC1', neuro: '\uD83E\uDDE0', gi: '\uD83C\uDF7D\uFE0F', obpeds: '\uD83D\uDC76',
            endo: '\u2697\uFE0F', musc: '\uD83E\uDDB4', psych: '\uD83E\uDDD8', hemonc: '\uD83E\uDE78', integ: '\uD83E\uDE79', pharm: '\uD83D\uDC8A'
        };
        var colorBaseMap = {
            'bg-rose': 'rose', 'bg-blue': 'blue', 'bg-purple': 'purple',
            'bg-emerald': 'emerald', 'bg-pink': 'pink', 'bg-amber': 'amber',
            'bg-teal': 'teal', 'bg-indigo': 'indigo', 'bg-red': 'red',
            'bg-orange': 'orange', 'bg-gray': 'gray'
        };

        var currentTab = 'cardio';
        var isHome = true;
        var quizIndex = 0;
        var quizScore = 0;
        var currentQuizData = [];
        var cardIndex = 0;
        var ghQuizCache = {};

        var audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            var osc = audioCtx.createOscillator();
            var gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            if (type === 'correct') {
                osc.type = 'sine';
                osc.frequency.setValueAtTime(880, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                osc.start(); osc.stop(audioCtx.currentTime + 0.1);
            } else {
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(150, audioCtx.currentTime);
                gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.2);
                osc.start(); osc.stop(audioCtx.currentTime + 0.2);
            }
        }

        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var temp = array[i]; array[i] = array[j]; array[j] = temp;
            }
            return array;
        }

        function renderCardInModal(item, data, idx, total) {
            document.getElementById('card-modal-header').className = 'card-modal-header ' + data.color;
            document.getElementById('card-modal-title').textContent = data.title + ' \u2014 Study Cards';
            document.getElementById('card-counter').textContent = (idx + 1) + ' / ' + total;
            document.getElementById('card-prev-btn').disabled = (idx === 0);
            document.getElementById('card-next-btn').disabled = (idx >= total - 1);
            document.getElementById('card-modal-body').innerHTML =
                '<div class="card-topic">' + item.topic + '</div>' +
                '<div class="card-section"><span class="card-label">Key Fact</span><div class="card-fact">' + item.fact + '</div></div>' +
                '<div class="card-section"><div class="card-alert-box"><span class="card-label" style="color:#b91c1c;">\u26A0\uFE0F Clinical Alert</span><div class="card-fact">' + item.alert + '</div></div></div>';
        }

        window.openCards = function(startIdx) {
            var data = contentData[currentTab];
            cardIndex = (typeof startIdx === 'number') ? startIdx : 0;
            renderCardInModal(data.data[cardIndex], data, cardIndex, data.data.length);
            document.getElementById('card-modal').style.display = 'flex';
        };
        window.prevCard = function() {
            var data = contentData[currentTab];
            if (cardIndex > 0) { cardIndex--; renderCardInModal(data.data[cardIndex], data, cardIndex, data.data.length); }
        };
        window.nextCard = function() {
            var data = contentData[currentTab];
            if (cardIndex < data.data.length - 1) { cardIndex++; renderCardInModal(data.data[cardIndex], data, cardIndex, data.data.length); }
        };
        window.closeCards = function() { document.getElementById('card-modal').style.display = 'none'; };

        window.switchTab = function(tabName) {
            currentTab = tabName;
            isHome = false;
            document.getElementById('home-dashboard').style.display = 'none';
            document.getElementById('section-view').style.display = 'block';
            document.getElementById('pdf-view').style.display = 'none';
            document.getElementById('home-back-btn').style.display = 'inline-block';
            var btns = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < btns.length; i++) {
                btns[i].className = 'tab-btn';
                if (btns[i].id === 'tab-' + tabName) {
                    btns[i].classList.add('active', contentData[tabName].color);
                } else {
                    var bKey = btns[i].id.replace('tab-','');
                    if (contentData[bKey]) btns[i].classList.add(contentData[bKey].color);
                }
            }
            renderContent();
        };

        window.showHome = function() {
            isHome = true;
            document.getElementById('home-dashboard').style.display = 'block';
            document.getElementById('section-view').style.display = 'none';
            document.getElementById('pdf-view').style.display = 'none';
            document.getElementById('home-back-btn').style.display = 'none';
            var btns = document.querySelectorAll('.tab-btn');
            for (var i = 0; i < btns.length; i++) {
                btns[i].className = 'tab-btn';
                var bKey = btns[i].id.replace('tab-','');
                if (contentData[bKey]) btns[i].classList.add(contentData[bKey].color);
            }
            renderDashboard();
        };

        function renderDashboard() {
            var keys = Object.keys(contentData);
            var html = '';
            for (var i = 0; i < keys.length; i++) {
                var key = keys[i];
                var sec = contentData[key];
                var emoji = sectionEmojis[key] || '\uD83D\uDCCB';
                var cBase = colorBaseMap[sec.color] || 'gray';
                html += '<div class="home-card" style="animation-delay:' + (i * 0.04) + 's;" onclick="switchTab(\'' + key + '\')">' +
                    '<div class="home-card-header" style="background-color:var(--' + cBase + '-100); color:var(--' + cBase + '-800);">' +
                        '<span class="home-card-emoji">' + emoji + '</span><span>' + sec.title + '</span></div>' +
                    '<div class="home-card-body"><div class="home-card-desc">' + sec.description + '</div>' +
                        '<div class="home-card-meta"><span>\uD83D\uDDC2 ' + sec.data.length + ' cards</span><span>\uD83E\uDDE0 100 Questions</span></div></div>' +
                    '<div class="home-card-footer">' +
                        '<button class="home-card-btn study-btn" onclick="event.stopPropagation(); switchTab(\'' + key + '\'); openCards(0);">Study Cards</button>' +
                        '<button class="home-card-btn quiz-btn" onclick="event.stopPropagation(); switchTab(\'' + key + '\'); setTimeout(startQuiz, 100);">Quiz Me</button></div></div>';
            }
            document.getElementById('home-grid').innerHTML = html;
        }

        function renderContent() {
            var data = contentData[currentTab];
            document.getElementById('desc-area').innerHTML = '<strong>' + data.title + ':</strong> ' + data.description;
            var rows = '';
            for (var i = 0; i < data.data.length; i++) {
                var item = data.data[i];
                rows += '<tr onclick="selectRow(this, ' + i + ')"><td class="topic-cell ' + data.type + '">' + item.topic + '</td><td class="key-point-cell">' + item.fact + '</td><td class="alert-cell">' + item.alert + '</td></tr>';
            }
            document.getElementById('content-area').innerHTML =
                '<div class="section-header-bar ' + data.color + '"><span>' + data.title + '</span>' +
                '<div class="header-btns"><button class="header-btn" onclick="openCards(0)">\uD83D\uDCC4 Study Cards</button>' +
                '<button class="header-btn" onclick="startQuiz()">\uD83E\uDDE0 Quiz Me</button></div></div>' +
                '<div class="table-container"><table><thead><tr><th>Topic</th><th>Key Point</th><th>\u26A0\uFE0F Alert</th></tr></thead>' +
                '<tbody id="table-body">' + rows + '</tbody></table></div>';
        }

        window.selectRow = function(rowEl, index) {
            var trs = document.querySelectorAll('#table-body tr');
            for (var i = 0; i < trs.length; i++) trs[i].classList.remove('selected');
            rowEl.classList.add('selected');
            openCards(index);
        };

        function fetchGitHubQuiz(sectionKey) {
            if (ghQuizCache[sectionKey]) return Promise.resolve(ghQuizCache[sectionKey]);
            var url = GH_CDN + 'mnt_quiz_json_' + sectionKey + '.json';
            return fetch(url).then(function(r) {
                if (!r.ok) throw new Error('HTTP ' + r.status);
                return r.json().then(function(j) {
                    var qs = (j.questions || []).map(function(item) {
                        return { q: item.q, a: item.options || item.a, correct: item.correct, rationale: item.rationale };
                    });
                    ghQuizCache[sectionKey] = qs;
                    return qs;
                });
            }).catch(function() { return []; });
        }

        window.startQuiz = function() {
            var data = contentData[currentTab];
            document.getElementById('quiz-modal').style.display = 'flex';
            document.getElementById('quiz-progress').textContent = 'Loading questions...';
            document.getElementById('q-text').textContent = '';
            document.getElementById('q-options').innerHTML = '';
            document.getElementById('feedback-area').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none';
            fetchGitHubQuiz(data.type).then(function(quizQs) {
                if (quizQs.length === 0) { document.getElementById('quiz-progress').textContent = 'No questions available yet.'; return; }
                currentQuizData = shuffleArray(quizQs);
                quizIndex = 0; quizScore = 0; showQuestion();
            });
        };

        function showQuestion() {
            var item = currentQuizData[quizIndex];
            var total = currentQuizData.length;
            document.getElementById('quiz-progress').textContent = 'Question ' + (quizIndex + 1) + ' of ' + total;
            document.getElementById('q-num-display').textContent = quizIndex + 1;
            document.getElementById('q-text').textContent = item.q;
            document.getElementById('feedback-area').style.display = 'none';
            document.getElementById('feedback-area').classList.remove('is-visible');
            document.getElementById('next-btn').style.display = 'none';
            var letters = ['A', 'B', 'C', 'D'];
            var optHTML = '';
            for (var i = 0; i < item.a.length; i++) {
                optHTML += '<button class="quiz-option" onclick="checkAnswer(' + i + ', ' + item.correct + ')"><span class="quiz-option-letter">' + letters[i] + '</span><span>' + item.a[i] + '</span></button>';
            }
            document.getElementById('q-options').innerHTML = optHTML;
        }

        window.checkAnswer = function(selected, correct) {
            var buttons = document.querySelectorAll('.quiz-option');
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].disabled = true; buttons[i].style.pointerEvents = 'none';
                if (i === correct) buttons[i].classList.add('correct-choice');
                else if (i === selected && selected !== correct) buttons[i].classList.add('wrong-choice');
            }
            var item = currentQuizData[quizIndex];
            var fh = document.getElementById('feedback-header');
            if (selected === correct) {
                quizScore++; fh.className = 'feedback-header correct'; fh.innerHTML = '\u2714\uFE0F Correct!'; playSound('correct');
            } else {
                fh.className = 'feedback-header incorrect'; fh.innerHTML = '\u274C Incorrect'; playSound('wrong');
            }
            document.getElementById('rationale-text').textContent = item.rationale;
            document.getElementById('feedback-area').style.display = 'block';
            document.getElementById('feedback-area').classList.add('is-visible');
            document.getElementById('next-btn').style.display = 'block';
            document.getElementById('next-btn').textContent = (quizIndex >= currentQuizData.length - 1) ?
                'Finish (' + quizScore + '/' + currentQuizData.length + ')' : 'Next Question';
            setTimeout(function() { document.getElementById('next-btn').scrollIntoView({ behavior: 'smooth', block: 'end' }); }, 100);
        };

        window.nextQuestion = function() {
            quizIndex++;
            if (quizIndex < currentQuizData.length) { showQuestion(); document.getElementById('quiz-modal').scrollTop = 0; }
            else { closeQuiz(); }
        };
        window.closeQuiz = function() { document.getElementById('quiz-modal').style.display = 'none'; };

        /* ===== PDF VIEWER ===== */
        var pdfDoc = null;
        var pdfPageNum = 1;
        var pdfScale = 1.0;
        var pdfCurrentUrl = '';
        var pdfConfigCache = null;
        var pdfJsLoaded = false;

        function loadPdfJs(cb) {
            if (pdfJsLoaded) { cb(); return; }
            var s = document.createElement('script');
            s.src = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js';
            s.onload = function() {
                fetch('https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js')
                    .then(function(r) { return r.blob(); })
                    .then(function(b) {
                        pdfjsLib.GlobalWorkerOptions.workerSrc = URL.createObjectURL(b);
                        pdfJsLoaded = true;
                        cb();
                    });
            };
            document.head.appendChild(s);
        }

        function loadPdfConfig(cb) {
            if (pdfConfigCache) { cb(pdfConfigCache); return; }
            fetch(GH_CDN + 'klimek_pdfs.json')
                .then(function(r) { if (!r.ok) throw new Error('HTTP ' + r.status); return r.json(); })
                .then(function(data) { return verifyPdfFiles(data).then(function(verified) { pdfConfigCache = verified; cb(verified); }); })
                .catch(function(err) {
                    document.getElementById('pdf-sidebar').innerHTML =
                        '<div class="pdf-loading" style="color:#f87171;">Failed to load PDF menu.<br><small>' + err.message + '</small></div>';
                });
        }

        function verifyPdfFiles(config) {
            var cats = config.categories || [];
            var checks = [];
            cats.forEach(function(cat) {
                (cat.items || []).forEach(function(item) {
                    var url = GH_CDN + 'pdfs/' + encodeURIComponent(item.file);
                    var controller = new AbortController();
                    var p = fetch(url, { signal: controller.signal })
                        .then(function(r) { item._exists = r.ok; controller.abort(); })
                        .catch(function(err) {
                            if (err.name !== 'AbortError') item._exists = false;
                        });
                    checks.push(p);
                });
            });
            return Promise.all(checks).then(function() {
                config.categories = cats.map(function(cat) {
                    cat.items = (cat.items || []).filter(function(item) { return item._exists; });
                    return cat;
                }).filter(function(cat) { return cat.items.length > 0; });
                return config;
            });
        }

        function renderPdfSidebar(config) {
            var sb = document.getElementById('pdf-sidebar');
            var cats = config.categories || [];
            if (cats.length === 0) {
                sb.innerHTML = '<div class="pdf-loading" style="color:#f59e0b;">No PDFs found.<br><small>Files may not be uploaded yet.</small></div>';
                return;
            }
            var html = '';
            for (var c = 0; c < cats.length; c++) {
                var cat = cats[c];
                html += '<div class="pdf-sidebar-cat" onclick="togglePdfCat(this)">' +
                    '<span class="cat-arrow open">\u25B6</span>' +
                    '<span>' + (cat.icon || '\uD83D\uDCC1') + ' ' + cat.name + '</span></div>' +
                    '<div class="pdf-sidebar-items">';
                var items = cat.items || [];
                for (var t = 0; t < items.length; t++) {
                    html += '<div class="pdf-sidebar-item" data-file="' + encodeURIComponent(items[t].file) + '" onclick="selectPdf(this, decodeURIComponent(this.getAttribute(\'data-file\')))">' +
                        '\uD83D\uDCC4 ' + items[t].title + '</div>';
                }
                html += '</div>';
            }
            sb.innerHTML = html;
        }

        window.togglePdfCat = function(el) {
            var items = el.nextElementSibling;
            var arrow = el.querySelector('.cat-arrow');
            if (items.style.display === 'none') {
                items.style.display = '';
                arrow.classList.add('open');
            } else {
                items.style.display = 'none';
                arrow.classList.remove('open');
            }
        };

        window.selectPdf = function(el, file) {
            var allItems = document.querySelectorAll('.pdf-sidebar-item');
            for (var i = 0; i < allItems.length; i++) allItems[i].classList.remove('active');
            el.classList.add('active');
            var url = GH_CDN + 'pdfs/' + encodeURIComponent(file);
            pdfCurrentUrl = url;
            document.getElementById('pdf-placeholder').style.display = 'none';
            document.getElementById('pdf-canvas').style.display = 'none';
            document.getElementById('pdf-toolbar').style.display = 'none';
            document.getElementById('pdf-canvas-wrap').innerHTML =
                '<div class="pdf-loading">Loading PDF...</div><canvas id="pdf-canvas" style="display:none;"></canvas>';
            loadPdfJs(function() {
                var loadingTask = pdfjsLib.getDocument(url);
                loadingTask.promise.then(function(pdf) {
                    pdfDoc = pdf;
                    pdfPageNum = 1;
                    pdfScale = 1.0;
                    document.getElementById('pdf-toolbar').style.display = 'flex';
                    renderPdfPage();
                }).catch(function(err) {
                    document.getElementById('pdf-canvas-wrap').innerHTML =
                        '<div class="pdf-placeholder" style="color:#f87171;">Failed to load PDF.<br><small style="color:#94a3b8;">' + err.message + '</small></div>';
                });
            });
        };

        function renderPdfPage() {
            pdfDoc.getPage(pdfPageNum).then(function(page) {
                var viewport = page.getViewport({ scale: pdfScale * 1.5 });
                var canvas = document.getElementById('pdf-canvas');
                if (!canvas) {
                    document.getElementById('pdf-canvas-wrap').innerHTML = '<canvas id="pdf-canvas"></canvas>';
                    canvas = document.getElementById('pdf-canvas');
                }
                var ctx = canvas.getContext('2d');
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                canvas.style.display = 'block';
                var loadingMsg = document.querySelector('#pdf-canvas-wrap .pdf-loading');
                if (loadingMsg) loadingMsg.remove();
                page.render({ canvasContext: ctx, viewport: viewport });
                document.getElementById('pdf-page-info').textContent = 'Page ' + pdfPageNum + ' of ' + pdfDoc.numPages;
                document.getElementById('pdf-zoom-info').textContent = Math.round(pdfScale * 100) + '%';
                document.getElementById('pdf-prev').disabled = (pdfPageNum <= 1);
                document.getElementById('pdf-next').disabled = (pdfPageNum >= pdfDoc.numPages);
            });
        }

        window.pdfPrevPage = function() { if (pdfPageNum > 1) { pdfPageNum--; renderPdfPage(); document.getElementById('pdf-canvas-wrap').scrollTop = 0; } };
        window.pdfNextPage = function() { if (pdfDoc && pdfPageNum < pdfDoc.numPages) { pdfPageNum++; renderPdfPage(); document.getElementById('pdf-canvas-wrap').scrollTop = 0; } };
        window.pdfZoomIn = function() { if (pdfScale < 3) { pdfScale = Math.round((pdfScale + 0.25) * 100) / 100; renderPdfPage(); } };
        window.pdfZoomOut = function() { if (pdfScale > 0.25) { pdfScale = Math.round((pdfScale - 0.25) * 100) / 100; renderPdfPage(); } };
        window.pdfDownload = function() {
            if (!pdfCurrentUrl) return;
            var a = document.createElement('a');
            a.href = pdfCurrentUrl;
            a.download = decodeURIComponent(pdfCurrentUrl.split('/').pop());
            a.click();
        };

        window.showPDFs = function() {
            document.getElementById('home-dashboard').style.display = 'none';
            document.getElementById('section-view').style.display = 'none';
            document.getElementById('pdf-view').style.display = 'block';
            document.getElementById('home-back-btn').style.display = 'inline-block';
            if (!pdfConfigCache) {
                document.getElementById('pdf-sidebar').innerHTML =
                    '<div class="pdf-loading">Checking available PDFs\u2026</div>';
            }
            loadPdfConfig(function(config) { renderPdfSidebar(config); });
        };
        /* ===== END PDF VIEWER ===== */

        showHome();

        } // end initApp
    })();
    </script>
</div>
</body>
</html>