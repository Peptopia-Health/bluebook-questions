<!DOCTYPE html>
<!-- Blue Book v5.0 - Peptopia Klimek Guide - GitHub CDN Edition -->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“– Blue Book</title>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,600;0,9..40,800;1,9..40,400&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { box-sizing: border-box; }
        html, body { margin: 0; padding: 0; min-height: 100vh; min-height: 100dvh; background: #b8aad0; }
        html.dark, html.dark body { background: #0f172a; }
    </style>
</head>
<body>
<script>
if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    document.documentElement.classList.add('dark');
}
window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', function(event) {
    if (event.matches) {
        document.documentElement.classList.add('dark');
    } else {
        document.documentElement.classList.remove('dark');
    }
});
</script>

<!-- Peptopia Klimek Guide Widget -->
<div id="peptopia-klimek-guide">
    <style>
        /* --- Scoped Styles --- */
        #peptopia-klimek-guide {
            /* Palette */
            --slate-50: #f8fafc; --slate-100: #f1f5f9; --slate-200: #e2e8f0;
            --slate-700: #334155; --slate-800: #1e293b; --slate-900: #0f172a; --white: #ffffff;

            /* Theme Colors */
            --rose-500: #fb7185;
            --blue-500: #06b6d4;
            --purple-500: #8b5cf6;
            --emerald-500: #10b981;
            --pink-500: #ec4899;
            --amber-500: #d97706;
            --teal-500: #14b8a6;
            --indigo-500: #6366f1;
            --red-600: #dc2626;
            --orange-600: #ea580c;
            --gray-600: #4b5563;

            /* Backgrounds (Pale versions) */
            --rose-50: #fff1f2; --blue-50: #ecfeff; --purple-50: #f5f3ff;
            --emerald-50: #ecfdf5; --pink-50: #fdf2f8; --amber-50: #fffbeb;
            --teal-50: #f0fdfa; --indigo-50: #eef2ff; --red-50: #fef2f2;
            --orange-50: #fff7ed; --gray-50: #f9fafb;

            /* Alert Colors */
            --alert-bg: #fff7ed;
            --alert-border: #fdba74;
            --alert-text: #1e293b;

            /* UI Accents */
            --accent-gold: #f59e0b;

            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: transparent;
            color: var(--slate-900);
            line-height: 1.6;
            font-size: 16px;
            max-width: 76rem;
            margin: 0 auto;
            padding: 0.75rem;
            box-sizing: border-box;
            -webkit-text-size-adjust: 100%;
        }

        html.dark #peptopia-klimek-guide {
            --slate-50: #0f172a; --slate-100: #1e293b; --slate-200: #334155;
            --slate-700: #cbd5e1; --slate-800: #0f172a; --slate-900: #f1f5f9; --white: #1e293b;
            --rose-50: #1a0a0d; --blue-50: #0a1a1f; --purple-50: #0f0a1f;
            --emerald-50: #0a1a12; --pink-50: #1a0a14; --amber-50: #1a150a;
            --teal-50: #0a1a17; --indigo-50: #0a0e1f; --red-50: #1a0a0a;
            --orange-50: #1a110a; --gray-50: #111827;
            --alert-bg: #1a150a; --alert-border: #92400e; --alert-text: #f1f5f9;
            background-color: transparent;
            color: #f1f5f9;
        }

        #peptopia-klimek-guide * { box-sizing: border-box; }

        /* Highlight Class for Key Terms */
        #peptopia-klimek-guide .highlight-term {
            background-color: #fef08a;
            color: #000;
            padding: 0.1rem 0.4rem;
            border-radius: 0.25rem;
            font-weight: 800;
            display: inline-block;
            margin-bottom: 2px;
        }
        html.dark #peptopia-klimek-guide .highlight-term {
            background-color: #fde68a;
            color: #1e1b4b;
        }

        /* Navbar â€” dark neon blue */
        #peptopia-klimek-guide .navbar {
            background: linear-gradient(135deg, #0a1628 0%, #0c2461 50%, #0a1628 100%);
            color: #fff; padding: 0.75rem 1rem;
            border-radius: 0.5rem; margin-bottom: 0.75rem; display: flex;
            justify-content: center; align-items: center;
            box-shadow: 0 4px 16px -2px rgba(10, 22, 40, 0.5), 0 0 20px rgba(30, 100, 255, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.25);
        }
        html.dark #peptopia-klimek-guide .navbar { background: linear-gradient(135deg, #020617 0%, #0c2461 50%, #020617 100%); border: 1px solid rgba(59, 130, 246, 0.3); }
        #peptopia-klimek-guide .nav-title { font-weight: 800; font-size: 1.3rem; display: flex; align-items: center; gap: 0.5rem; }

        /* Tabs â€” horizontal scroll on mobile */
        #peptopia-klimek-guide .tabs-container {
            display: flex; flex-wrap: nowrap; gap: 0.3rem; margin-bottom: 1rem;
            overflow-x: auto; -webkit-overflow-scrolling: touch;
            padding-bottom: 0.35rem;
            scrollbar-width: thin;
        }
        #peptopia-klimek-guide .tabs-container::-webkit-scrollbar { height: 4px; }
        #peptopia-klimek-guide .tabs-container::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 4px; }

        #peptopia-klimek-guide .tab-btn {
            padding: 0.5rem 0.65rem; border-radius: 0.5rem; font-weight: 700;
            color: #312e81; border: none;
            cursor: pointer; transition: all 0.15s; font-size: 0.8rem;
            filter: opacity(0.85);
            text-align: center;
            white-space: nowrap; flex-shrink: 0;
        }
        #peptopia-klimek-guide .tab-btn:hover { filter: grayscale(0%) opacity(1); transform: translateY(-1px); }
        #peptopia-klimek-guide .tab-btn.active {
            filter: opacity(1);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.1), 0 0 0 2px #312e81;
            transform: translateY(1px);
            color: #312e81;
        }

        /* Tab Colors â€” light pastels with dark blue text */
        #peptopia-klimek-guide #tab-cardio { background-color: #fecdd3; }
        #peptopia-klimek-guide #tab-resp { background-color: #a5f3fc; }
        #peptopia-klimek-guide #tab-neuro { background-color: #ddd6fe; }
        #peptopia-klimek-guide #tab-gi { background-color: #a7f3d0; }
        #peptopia-klimek-guide #tab-obpeds { background-color: #fbcfe8; }
        #peptopia-klimek-guide #tab-endo { background-color: #fde68a; }
        #peptopia-klimek-guide #tab-musc { background-color: #99f6e4; }
        #peptopia-klimek-guide #tab-psych { background-color: #c7d2fe; }
        #peptopia-klimek-guide #tab-hemonc { background-color: #fecaca; }
        #peptopia-klimek-guide #tab-integ { background-color: #fed7aa; }
        #peptopia-klimek-guide #tab-pharm { background-color: #d1d5db; }

        /* --- Section Header Bar --- */
        #peptopia-klimek-guide .section-header-bar {
            padding: 0.65rem 1rem; min-height: 44px; color: white;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 0.75rem;
            font-size: 1.15rem; font-weight: 800;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            gap: 0.5rem;
        }

        #peptopia-klimek-guide .header-btn {
            background-color: #312e81;
            color: white; border: 2px solid rgba(255,255,255,0.5);
            padding: 0.45rem 1rem; border-radius: 0.5rem;
            font-size: 0.9rem; font-weight: 700; cursor: pointer;
            transition: all 0.2s; white-space: nowrap;
            -webkit-tap-highlight-color: transparent;
        }
        #peptopia-klimek-guide .header-btn:hover {
            background-color: white; color: #312e81; transform: scale(1.02);
        }
        #peptopia-klimek-guide .header-btns { display: flex; gap: 0.4rem; flex-shrink: 0; }

        /* --- Study Card Modal --- */
        #peptopia-klimek-guide .card-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.92); z-index: 1999;
            align-items: flex-start; justify-content: center;
            padding: 0; overflow-y: auto; -webkit-overflow-scrolling: touch;
        }
        #peptopia-klimek-guide .card-modal {
            background: var(--white); width: 100%; max-width: 560px;
            border-radius: 0; min-height: 100vh; min-height: 100dvh;
            display: flex; flex-direction: column;
        }
        @media (min-width: 640px) {
            #peptopia-klimek-guide .card-overlay { align-items: center; padding: 1.5rem; }
            #peptopia-klimek-guide .card-modal {
                border-radius: 1rem; min-height: auto;
                box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5);
            }
        }
        html.dark #peptopia-klimek-guide .card-modal { background: #1e293b; }
        #peptopia-klimek-guide .card-modal-header {
            padding: 0.75rem 1rem; color: white; font-weight: 800; font-size: 1rem;
            display: flex; justify-content: space-between; align-items: center;
            border-radius: 0 0 0 0;
        }
        @media (min-width: 640px) {
            #peptopia-klimek-guide .card-modal-header { border-radius: 1rem 1rem 0 0; }
        }
        #peptopia-klimek-guide .card-modal-header .card-close-btn {
            background: none; border: none; color: white; font-size: 1.5rem; cursor: pointer;
            padding: 0 0.25rem; line-height: 1;
        }
        #peptopia-klimek-guide .card-modal-body { padding: 1.25rem; flex-grow: 1; }
        #peptopia-klimek-guide .card-modal-body .card-topic {
            font-size: 1.35rem; font-weight: 800; margin-bottom: 1rem; color: var(--slate-900);
        }
        html.dark #peptopia-klimek-guide .card-modal-body .card-topic { color: #f1f5f9; }
        #peptopia-klimek-guide .card-modal-body .card-section {
            margin-bottom: 1rem;
        }
        #peptopia-klimek-guide .card-modal-body .card-label {
            font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1px;
            color: #64748b; font-weight: 800; margin-bottom: 0.3rem; display: block;
        }
        html.dark #peptopia-klimek-guide .card-modal-body .card-label { color: #94a3b8; }
        #peptopia-klimek-guide .card-modal-body .card-fact {
            font-size: 1.05rem; line-height: 1.5; color: var(--slate-900);
        }
        html.dark #peptopia-klimek-guide .card-modal-body .card-fact { color: #e2e8f0; }
        #peptopia-klimek-guide .card-modal-body .card-alert-box {
            background: #fff1f2; border-left: 5px solid #e11d48;
            padding: 0.75rem; border-radius: 0.25rem;
        }
        html.dark #peptopia-klimek-guide .card-modal-body .card-alert-box { background: #1c1012; border-left-color: #be123c; }
        #peptopia-klimek-guide .card-modal-body .card-alert-box .card-fact { font-size: 0.95rem; }
        #peptopia-klimek-guide .card-nav {
            display: flex; justify-content: space-between; align-items: center;
            padding: 0.75rem 1rem; border-top: 1px solid var(--slate-200);
            gap: 0.5rem;
        }
        html.dark #peptopia-klimek-guide .card-nav { border-top-color: #334155; }
        #peptopia-klimek-guide .card-nav-btn {
            background: #4f46e5; color: white; border: none;
            padding: 0.55rem 1.25rem; border-radius: 2rem; font-weight: 700;
            cursor: pointer; font-size: 0.9rem; transition: background 0.15s;
            -webkit-tap-highlight-color: transparent;
        }
        #peptopia-klimek-guide .card-nav-btn:hover { background: #4338ca; }
        #peptopia-klimek-guide .card-nav-btn:disabled { opacity: 0.35; cursor: default; }
        #peptopia-klimek-guide .card-counter {
            font-size: 0.85rem; font-weight: 700; color: #64748b; white-space: nowrap;
        }
        html.dark #peptopia-klimek-guide .card-counter { color: #94a3b8; }

        /* --- Description Box --- */
        #peptopia-klimek-guide .description-box {
            padding: 0.75rem 1rem; background: var(--white);
            border: 2px solid var(--slate-200); border-radius: 0.5rem;
            border-left: 5px solid var(--slate-700);
            font-size: 0.95rem; color: var(--slate-900); font-weight: 500;
            margin-bottom: 1rem;
        }
        html.dark #peptopia-klimek-guide .description-box { background: #1e293b; border-color: #475569; border-left-color: #94a3b8; }

        /* --- Main Layout --- */
        #peptopia-klimek-guide .grid-layout {
            display: flex; flex-direction: column; gap: 1rem;
            align-items: stretch;
        }

        /* --- Data Table --- */
        #peptopia-klimek-guide .table-container {
            overflow-x: auto; -webkit-overflow-scrolling: touch;
            border: 2px solid #334155;
            border-radius: 0.75rem;
            background: var(--white);
            max-height: 500px; overflow-y: auto;
        }
        html.dark #peptopia-klimek-guide .table-container { background: #1e293b; border-color: #475569; }
        #peptopia-klimek-guide table { width: 100%; border-collapse: collapse; text-align: left; font-size: 0.85rem; }
        #peptopia-klimek-guide th {
            padding: 0.6rem 0.65rem;
            background-color: #f1f5f9;
            color: #0f172a;
            border-bottom: 2px solid #e2e8f0;
            position: sticky; top: 0; z-index: 5;
            font-weight: 800; font-size: 0.8rem;
            white-space: nowrap;
        }
        html.dark #peptopia-klimek-guide th { background-color: #334155; color: #f1f5f9; border-bottom-color: #475569; }
        #peptopia-klimek-guide td { padding: 0.6rem 0.65rem; border-bottom: 1px solid #e2e8f0; vertical-align: top; }
        html.dark #peptopia-klimek-guide td { border-bottom-color: #334155; color: #e2e8f0; }
        #peptopia-klimek-guide tr:hover td { cursor: pointer; background-color: #f8fafc; }
        html.dark #peptopia-klimek-guide tr:hover td { background-color: #1e293b; }
        #peptopia-klimek-guide tr.selected td { border-left: 4px solid var(--accent-gold); background-color: #fffbeb; }
        html.dark #peptopia-klimek-guide tr.selected td { background-color: #1c1917; }

        /* Cell Specifics */
        #peptopia-klimek-guide .topic-cell { font-weight: 800; white-space: nowrap; color: #000; vertical-align: top; }
        html.dark #peptopia-klimek-guide .topic-cell { color: #f1f5f9; }
        #peptopia-klimek-guide .topic-cell.cardio { background-color: var(--rose-50); }
        #peptopia-klimek-guide .topic-cell.resp { background-color: var(--blue-50); }
        #peptopia-klimek-guide .topic-cell.neuro { background-color: var(--purple-50); }
        #peptopia-klimek-guide .topic-cell.gi { background-color: var(--emerald-50); }
        #peptopia-klimek-guide .topic-cell.obpeds { background-color: var(--pink-50); }
        #peptopia-klimek-guide .topic-cell.endo { background-color: var(--amber-50); }
        #peptopia-klimek-guide .topic-cell.musc { background-color: var(--teal-50); }
        #peptopia-klimek-guide .topic-cell.psych { background-color: var(--indigo-50); }
        #peptopia-klimek-guide .topic-cell.hemonc { background-color: var(--red-50); }
        #peptopia-klimek-guide .topic-cell.integ { background-color: var(--orange-50); }
        #peptopia-klimek-guide .topic-cell.pharm { background-color: var(--gray-50); }

        #peptopia-klimek-guide .key-point-cell { color: #334155; font-style: normal; font-weight: 500; }
        html.dark #peptopia-klimek-guide .key-point-cell { color: #cbd5e1; }
        #peptopia-klimek-guide .alert-cell { color: #991b1b; background-color: #fef2f2; border-left: 3px solid #f87171; font-weight: 600; }
        html.dark #peptopia-klimek-guide .alert-cell { background-color: #1c1012; color: #fca5a5; border-left-color: #dc2626; }

        /* Mobile: card-style rows instead of wide table */
        @media (max-width: 600px) {
            #peptopia-klimek-guide .table-container { max-height: none; }
            #peptopia-klimek-guide table, #peptopia-klimek-guide thead, #peptopia-klimek-guide tbody,
            #peptopia-klimek-guide th, #peptopia-klimek-guide td, #peptopia-klimek-guide tr {
                display: block; width: 100%;
            }
            #peptopia-klimek-guide thead { display: none; }
            #peptopia-klimek-guide tr {
                border-bottom: 2px solid #e2e8f0; padding: 0.6rem 0; margin-bottom: 0.35rem;
            }
            html.dark #peptopia-klimek-guide tr { border-bottom-color: #334155; }
            #peptopia-klimek-guide td {
                padding: 0.3rem 0.65rem; border-bottom: none; position: relative;
                padding-left: 0.65rem;
            }
            #peptopia-klimek-guide .topic-cell {
                font-size: 0.95rem; padding-bottom: 0.15rem;
                white-space: normal;
            }
            #peptopia-klimek-guide .key-point-cell::before { content: '\01F4CC '; }
            #peptopia-klimek-guide .alert-cell {
                border-left: 3px solid #f87171; margin: 0.2rem 0.3rem;
                border-radius: 0.25rem; padding: 0.4rem 0.6rem;
                font-size: 0.85rem;
            }
            #peptopia-klimek-guide tr.selected td { border-left: none; }
            #peptopia-klimek-guide tr.selected { border-left: 4px solid var(--accent-gold); background: #fffbeb; border-radius: 0.5rem; }
            html.dark #peptopia-klimek-guide tr.selected { background: #1c1917; }
        }

        /* --- QUIZ STYLES --- */
        #peptopia-klimek-guide .quiz-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.96); z-index: 2000;
            align-items: flex-start; justify-content: center;
            padding: 0;
            overflow-y: auto; -webkit-overflow-scrolling: touch;
        }
        #peptopia-klimek-guide .quiz-box {
            background: #1e1b4b;
            width: 100%; max-width: 700px; padding: 1.25rem; border-radius: 0;
            border: none;
            color: white; display: flex; flex-direction: column;
            min-height: 100vh; min-height: 100dvh;
        }
        @media (min-width: 640px) {
            #peptopia-klimek-guide .quiz-overlay { align-items: center; padding: 1rem; }
            #peptopia-klimek-guide .quiz-box {
                border-radius: 1rem; min-height: auto; max-height: none;
                border: 1px solid #4338ca;
                box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
                padding: 1.75rem;
            }
        }
        #peptopia-klimek-guide .quiz-question-number {
            background: #4338ca; width: 36px; height: 36px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 800; margin-right: 0.75rem; flex-shrink: 0; font-size: 0.9rem;
        }
        #peptopia-klimek-guide .quiz-header-row { display: flex; align-items: flex-start; margin-bottom: 1.25rem; }
        #peptopia-klimek-guide .quiz-question-text { font-size: 1.1rem; line-height: 1.5; font-weight: 500; }

        /* Options */
        #peptopia-klimek-guide .quiz-option {
            background: #312e81; border: 2px solid #4338ca;
            padding: 0.85rem; margin-bottom: 0.5rem; border-radius: 0.5rem;
            cursor: pointer; transition: all 0.15s;
            display: flex; align-items: center;
            font-size: 1rem; color: #e0e7ff;
            width: 100%; text-align: left;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        #peptopia-klimek-guide .quiz-option:hover { background: #3730a3; border-color: #6366f1; }
        @media (hover: none) {
            #peptopia-klimek-guide .quiz-option:hover { background: #312e81; border-color: #4338ca; }
            #peptopia-klimek-guide .quiz-option:active { background: #3730a3; border-color: #6366f1; }
        }

        #peptopia-klimek-guide .quiz-option.correct-choice {
            background: #064e3b; border-color: #10b981; color: white;
        }
        #peptopia-klimek-guide .quiz-option.wrong-choice {
            background: #7f1d1d; border-color: #ef4444; color: white; opacity: 0.8;
        }

        #peptopia-klimek-guide .quiz-option-letter {
            background: rgba(255,255,255,0.1); width: 28px; height: 28px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            margin-right: 0.75rem; font-weight: 700; font-size: 0.85rem; flex-shrink: 0;
        }

        /* Feedback Section */
        #peptopia-klimek-guide .feedback-container {
            margin-top: 1rem; background: #312e81; border-radius: 0.5rem;
            border: 1px solid #4338ca;
        }
        #peptopia-klimek-guide .feedback-container[style*="display: block"],
        #peptopia-klimek-guide .feedback-container.is-visible {
            display: block !important;
        }
        #peptopia-klimek-guide .feedback-header {
            padding: 0.6rem 0.85rem; font-weight: 800; display: flex; align-items: center; gap: 0.5rem;
            font-size: 1rem;
        }
        #peptopia-klimek-guide .feedback-header.correct { background: #065f46; color: #34d399; border-radius: 0.5rem 0.5rem 0 0; }
        #peptopia-klimek-guide .feedback-header.incorrect { background: #7f1d1d; color: #fca5a5; border-radius: 0.5rem 0.5rem 0 0; }

        #peptopia-klimek-guide .feedback-content { padding: 0.85rem; font-size: 0.95rem; line-height: 1.6; color: #e0e7ff; }
        #peptopia-klimek-guide .rationale-label { color: #a5b4fc; font-weight: 800; display: block; margin-bottom: 0.4rem; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px; }

        /* Controls */
        #peptopia-klimek-guide .quiz-footer {
            margin-top: 1.25rem; display: flex; justify-content: center; align-items: center;
            padding-bottom: env(safe-area-inset-bottom, 0.5rem);
        }
        #peptopia-klimek-guide .next-q-btn {
            background: #4f46e5; color: white; border: none; padding: 0.75rem 2.5rem;
            border-radius: 2rem; font-weight: 800; cursor: pointer;
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.4);
            font-size: 1rem;
            -webkit-tap-highlight-color: transparent;
            width: 100%; max-width: 320px;
        }
        #peptopia-klimek-guide .next-q-btn:hover { background: #4338ca; }
        @media (hover: none) {
            #peptopia-klimek-guide .next-q-btn:active { background: #4338ca; transform: scale(0.98); }
        }

        /* Mobile tuning */
        @media (max-width: 600px) {
            #peptopia-klimek-guide .section-header-bar { font-size: 1rem; padding: 0.5rem 0.75rem; flex-wrap: wrap; }
            #peptopia-klimek-guide .nav-title { font-size: 1.15rem; }
        }

        /* Color Classes for section header bars */
        #peptopia-klimek-guide .bg-rose { background-color: var(--rose-500) !important; border-color: var(--rose-500) !important; }
        #peptopia-klimek-guide .bg-blue { background-color: var(--blue-500) !important; border-color: var(--blue-500) !important; }
        #peptopia-klimek-guide .bg-purple { background-color: var(--purple-500) !important; border-color: var(--purple-500) !important; }
        #peptopia-klimek-guide .bg-emerald { background-color: var(--emerald-500) !important; border-color: var(--emerald-500) !important; }
        #peptopia-klimek-guide .bg-pink { background-color: var(--pink-500) !important; border-color: var(--pink-500) !important; }
        #peptopia-klimek-guide .bg-amber { background-color: var(--amber-500) !important; border-color: var(--amber-500) !important; }
        #peptopia-klimek-guide .bg-teal { background-color: var(--teal-500) !important; border-color: var(--teal-500) !important; }
        #peptopia-klimek-guide .bg-indigo { background-color: var(--indigo-500) !important; border-color: var(--indigo-500) !important; }
        #peptopia-klimek-guide .bg-red { background-color: var(--red-600) !important; border-color: var(--red-600) !important; }
        #peptopia-klimek-guide .bg-orange { background-color: var(--orange-600) !important; border-color: var(--orange-600) !important; }
        #peptopia-klimek-guide .bg-gray { background-color: var(--gray-600) !important; border-color: var(--gray-600) !important; }

        /* Loading spinner */
        #peptopia-klimek-guide .loading-container {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 3rem 1rem; gap: 1rem;
        }
        #peptopia-klimek-guide .spinner {
            width: 40px; height: 40px;
            border: 4px solid var(--slate-200);
            border-top-color: #4f46e5;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        #peptopia-klimek-guide .loading-text {
            font-weight: 600; color: var(--slate-700); font-size: 0.95rem;
        }

        /* Error state */
        #peptopia-klimek-guide .error-box {
            background: #fef2f2; border: 2px solid #fca5a5; border-radius: 0.75rem;
            padding: 1.25rem; text-align: center; color: #991b1b;
        }
        html.dark #peptopia-klimek-guide .error-box {
            background: #1c1012; border-color: #7f1d1d; color: #fca5a5;
        }
        #peptopia-klimek-guide .error-box button {
            background: #dc2626; color: white; border: none; padding: 0.5rem 1.5rem;
            border-radius: 0.5rem; font-weight: 700; cursor: pointer; margin-top: 0.75rem;
            font-size: 0.9rem;
        }
        #peptopia-klimek-guide .error-box button:hover { background: #b91c1c; }
    </style>

    <!-- Navbar -->
    <nav class="navbar">
        <div class="nav-title">
            &#128214; Blue Book
        </div>
    </nav>

    <!-- Tabs -->
    <div class="tabs-container">
        <button class="tab-btn active" id="tab-cardio" onclick="switchTab('cardio')">Cardio</button>
        <button class="tab-btn" id="tab-resp" onclick="switchTab('resp')">Resp</button>
        <button class="tab-btn" id="tab-neuro" onclick="switchTab('neuro')">Neuro</button>
        <button class="tab-btn" id="tab-gi" onclick="switchTab('gi')">GI & Nutr</button>
        <button class="tab-btn" id="tab-obpeds" onclick="switchTab('obpeds')">OB & Peds</button>
        <button class="tab-btn" id="tab-endo" onclick="switchTab('endo')">Endocrine</button>
        <button class="tab-btn" id="tab-musc" onclick="switchTab('musc')">Musculoskeletal</button>
        <button class="tab-btn" id="tab-psych" onclick="switchTab('psych')">Psych</button>
        <button class="tab-btn" id="tab-hemonc" onclick="switchTab('hemonc')">Heme/Onc</button>
        <button class="tab-btn" id="tab-integ" onclick="switchTab('integ')">Integ/Sensory</button>
        <button class="tab-btn" id="tab-pharm" onclick="switchTab('pharm')">Pharm</button>
    </div>

    <!-- Description -->
    <div id="desc-area" class="description-box"></div>

    <!-- Content -->
    <div id="content-area"></div>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="quiz-overlay">
        <div class="quiz-box">
            <div style="display:flex; justify-content:space-between; margin-bottom:1rem;">
                <span style="color:#818cf8; font-weight:700;" id="quiz-progress">Question 1 of ?</span>
                <button onclick="closeQuiz()" style="background:none; border:none; color:#818cf8; font-size:1.5rem; cursor:pointer;">&times;</button>
            </div>

            <div class="quiz-header-row">
                <div class="quiz-question-number" id="q-num-display">1</div>
                <div class="quiz-question-text" id="q-text"></div>
            </div>

            <div id="q-options"></div>

            <div id="feedback-area" class="feedback-container">
                <div class="feedback-header" id="feedback-header"></div>
                <div class="feedback-content">
                    <span class="rationale-label">Rationale:</span>
                    <span id="rationale-text"></span>
                </div>
            </div>

            <div class="quiz-footer">
                <button class="next-q-btn" id="next-btn" style="display:none;" onclick="nextQuestion()">Next Question</button>
            </div>
        </div>
    </div>

    <!-- Study Card Modal -->
    <div id="card-modal" class="card-overlay">
        <div class="card-modal">
            <div class="card-modal-header" id="card-modal-header">
                <span id="card-modal-title">Study Cards</span>
                <button class="card-close-btn" onclick="closeCards()">&times;</button>
            </div>
            <div class="card-modal-body" id="card-modal-body"></div>
            <div class="card-nav">
                <button class="card-nav-btn" id="card-prev-btn" onclick="prevCard()">&#8592; Prev</button>
                <span class="card-counter" id="card-counter">1 / ?</span>
                <button class="card-nav-btn" id="card-next-btn" onclick="nextCard()">Next &#8594;</button>
            </div>
        </div>
    </div>

    <!-- Data & Logic -->
    <script>
    (function() {
        // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        // â•‘  CONFIGURATION                                       â•‘
        // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        var GITHUB_USERNAME = 'Peptopia-Health';
        var GITHUB_REPO = 'bluebook-questions';
        var CDN_BASE = 'https://cdn.jsdelivr.net/gh/' + GITHUB_USERNAME + '/' + GITHUB_REPO + '/';

        // Section metadata (title, description, colors, quiz file names)
        var sections = {
            cardio: {
                title: 'Cardiovascular System',
                description: 'Heart & vascular assessment, cardiac disorders, interventions, and EKG fundamentals.',
                color: 'bg-rose', type: 'cardio', quizFile: 'mnt_quiz_json_cardio.json'
            },
            resp: {
                title: 'Respiratory System',
                description: 'Airway management, oxygenation, ventilation, and respiratory disorders.',
                color: 'bg-blue', type: 'resp', quizFile: 'mnt_quiz_json_resp.json'
            },
            neuro: {
                title: 'Neurological System',
                description: 'Cranial nerves, level of consciousness, seizures, stroke, and spinal cord injuries.',
                color: 'bg-purple', type: 'neuro', quizFile: 'mnt_quiz_json_neuro.json'
            },
            gi: {
                title: 'GI & Nutrition',
                description: 'Gastrointestinal disorders, nutrition, fluid & electrolyte balance, and tube feedings.',
                color: 'bg-emerald', type: 'gi', quizFile: 'mnt_quiz_json_gi.json'
            },
            obpeds: {
                title: 'OB & Pediatrics',
                description: 'Maternal-newborn nursing, pediatric growth & development, and childhood illnesses.',
                color: 'bg-pink', type: 'obpeds', quizFile: 'mnt_quiz_json_obpeds.json'
            },
            endo: {
                title: 'Endocrine System',
                description: 'Diabetes, thyroid, adrenal, and pituitary disorders with pharmacological management.',
                color: 'bg-amber', type: 'endo', quizFile: 'mnt_quiz_json_endo.json'
            },
            musc: {
                title: 'Musculoskeletal System',
                description: 'Fractures, traction, casts, joint replacements, and mobility disorders.',
                color: 'bg-teal', type: 'musc', quizFile: 'mnt_quiz_json_musc.json'
            },
            psych: {
                title: 'Psychiatric Nursing',
                description: 'Mental health disorders, therapeutic communication, crisis intervention, and psychopharmacology.',
                color: 'bg-indigo', type: 'psych', quizFile: 'mnt_quiz_json_psych.json'
            },
            hemonc: {
                title: 'Hematology & Oncology',
                description: 'Blood disorders, cancer treatments, transfusion reactions, and oncology nursing care.',
                color: 'bg-red', type: 'hemonc', quizFile: 'mnt_quiz_json_hemonc.json'
            },
            integ: {
                title: 'Integumentary & Sensory',
                description: 'Burns, wounds, skin disorders, eye & ear conditions, and sensory assessment.',
                color: 'bg-orange', type: 'integ', quizFile: 'mnt_quiz_json_integ.json'
            },
            pharm: {
                title: 'Pharmacology',
                description: 'Drug classifications, mechanisms of action, side effects, and nursing considerations.',
                color: 'bg-gray', type: 'pharm', quizFile: 'mnt_quiz_json_pharm.json'
            }
        };

        // Content data cache (loaded from GitHub)
        var contentData = {};
        // Quiz data cache (loaded from GitHub)
        var quizCache = {};

        var currentTab = 'cardio';
        var quizIndex = 0;
        var quizScore = 0;
        var currentQuizData = [];
        var cardIndex = 0;

        // Audio Context for Beeps
        var audioCtx = null;
        function getAudioCtx() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioCtx;
        }
        function playSound(type) {
            try {
                var ctx = getAudioCtx();
                if (ctx.state === 'suspended') ctx.resume();
                var osc = ctx.createOscillator();
                var gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);

                if (type === 'correct') {
                    osc.type = 'sine';
                    osc.frequency.setValueAtTime(880, ctx.currentTime);
                    osc.frequency.exponentialRampToValueAtTime(440, ctx.currentTime + 0.1);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.1);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.1);
                } else {
                    osc.type = 'sawtooth';
                    osc.frequency.setValueAtTime(150, ctx.currentTime);
                    gain.gain.setValueAtTime(0.1, ctx.currentTime);
                    gain.gain.linearRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                    osc.start();
                    osc.stop(ctx.currentTime + 0.2);
                }
            } catch (e) {
                // Audio not available in this environment
            }
        }

        // Shuffle function (Fisher-Yates)
        function shuffleArray(array) {
            for (var i = array.length - 1; i > 0; i--) {
                var j = Math.floor(Math.random() * (i + 1));
                var tmp = array[i]; array[i] = array[j]; array[j] = tmp;
            }
            return array;
        }

        // --- Fetch content data from GitHub CDN ---
        function fetchSectionData(tabName) {
            return new Promise(function(resolve, reject) {
                // Check cache first
                if (contentData[tabName]) {
                    resolve(contentData[tabName]);
                    return;
                }

                var sec = sections[tabName];
                var url = CDN_BASE + sec.quizFile;

                fetch(url)
                    .then(function(res) {
                        if (!res.ok) throw new Error('HTTP ' + res.status);
                        return res.json();
                    })
                    .then(function(json) {
                        var entry = {
                            title: sec.title,
                            description: sec.description,
                            color: sec.color,
                            type: sec.type,
                            data: []
                        };

                        // If the JSON has a "studyCards" array, use it for the table/cards
                        if (json.studyCards && json.studyCards.length > 0) {
                            entry.data = json.studyCards;
                        }

                        // Store quiz questions separately
                        if (json.questions && json.questions.length > 0) {
                            quizCache[tabName] = json.questions;
                        }

                        // If the JSON has a combined "data" array (original format), use that
                        if (json.data && json.data.length > 0) {
                            entry.data = json.data;
                        }

                        // If entry.data is still empty but we have questions, build study data from questions
                        if (entry.data.length === 0 && quizCache[tabName]) {
                            entry.data = quizCache[tabName].map(function(qItem) {
                                return {
                                    topic: qItem.q ? qItem.q.substring(0, 60) + (qItem.q.length > 60 ? '...' : '') : 'Question',
                                    fact: qItem.options ? qItem.options[qItem.correct] : '',
                                    alert: qItem.rationale || '',
                                    q: qItem.q,
                                    a: qItem.options,
                                    correct: qItem.correct,
                                    rationale: qItem.rationale
                                };
                            });
                        }

                        contentData[tabName] = entry;
                        resolve(entry);
                    })
                    .catch(function(err) {
                        reject(err);
                    });
            });
        }

        // --- Loading/Error UI ---
        function showLoading(container) {
            container.innerHTML =
                '<div class="loading-container">' +
                    '<div class="spinner"></div>' +
                    '<div class="loading-text">Loading study material...</div>' +
                '</div>';
        }

        function showError(container, tabName) {
            var sec = sections[tabName];
            container.innerHTML =
                '<div class="error-box">' +
                    '<div style="font-size:2rem; margin-bottom:0.5rem;">&#9888;&#65039;</div>' +
                    '<div style="font-weight:800; margin-bottom:0.5rem;">Could not load ' + sec.title + '</div>' +
                    '<div style="font-size:0.9rem; margin-bottom:0.75rem;">Check your internet connection or GitHub configuration.</div>' +
                    '<button onclick="switchTab(\'' + tabName + '\')">Try Again</button>' +
                '</div>';
        }

        // --- Study Card Modal Logic ---
        function renderCardInModal(item, data, idx, total) {
            document.getElementById('card-modal-header').className = 'card-modal-header ' + data.color;
            document.getElementById('card-modal-title').textContent = data.title + ' \u2014 Study Cards';
            document.getElementById('card-counter').textContent = (idx + 1) + ' / ' + total;
            document.getElementById('card-prev-btn').disabled = (idx === 0);
            document.getElementById('card-next-btn').disabled = (idx >= total - 1);
            document.getElementById('card-modal-body').innerHTML =
                '<div class="card-topic">' + item.topic + '</div>' +
                '<div class="card-section">' +
                    '<span class="card-label">Key Fact</span>' +
                    '<div class="card-fact">' + item.fact + '</div>' +
                '</div>' +
                '<div class="card-section">' +
                    '<div class="card-alert-box">' +
                        '<span class="card-label" style="color:#b91c1c;">&#9888;&#65039; Clinical Alert</span>' +
                        '<div class="card-fact">' + item.alert + '</div>' +
                    '</div>' +
                '</div>';
        }

        window.openCards = function(startIdx) {
            var data = contentData[currentTab];
            if (!data || !data.data || data.data.length === 0) return;
            cardIndex = (typeof startIdx === 'number') ? startIdx : 0;
            renderCardInModal(data.data[cardIndex], data, cardIndex, data.data.length);
            document.getElementById('card-modal').style.display = 'flex';
        };
        window.prevCard = function() {
            var data = contentData[currentTab];
            if (!data) return;
            if (cardIndex > 0) { cardIndex--; renderCardInModal(data.data[cardIndex], data, cardIndex, data.data.length); }
        };
        window.nextCard = function() {
            var data = contentData[currentTab];
            if (!data) return;
            if (cardIndex < data.data.length - 1) { cardIndex++; renderCardInModal(data.data[cardIndex], data, cardIndex, data.data.length); }
        };
        window.closeCards = function() {
            document.getElementById('card-modal').style.display = 'none';
        };

        // --- Tab Switching ---
        window.switchTab = function(tabName) {
            currentTab = tabName;
            document.querySelectorAll('.tab-btn').forEach(function(btn) {
                btn.classList.remove('active');
                if (btn.id === 'tab-' + tabName) {
                    btn.classList.add('active');
                }
            });
            renderContent();
        };

        // --- Render Content ---
        function renderContent() {
            var sec = sections[currentTab];
            var descArea = document.getElementById('desc-area');
            var contentArea = document.getElementById('content-area');

            descArea.innerHTML = '<strong>' + sec.title + ':</strong> ' + sec.description;

            // If data is already cached, render immediately
            if (contentData[currentTab]) {
                renderTable(contentData[currentTab]);
                return;
            }

            // Otherwise show loading and fetch
            showLoading(contentArea);

            fetchSectionData(currentTab)
                .then(function(data) {
                    // Only render if user is still on the same tab
                    if (currentTab === data.type) {
                        renderTable(data);
                    }
                })
                .catch(function() {
                    if (currentTab === sec.type) {
                        showError(contentArea, currentTab);
                    }
                });
        }

        function renderTable(data) {
            var contentArea = document.getElementById('content-area');

            var tableRows = data.data.map(function(item, i) {
                return '<tr onclick="selectRow(this, ' + i + ')">' +
                    '<td class="topic-cell ' + data.type + '">' + item.topic + '</td>' +
                    '<td class="key-point-cell">' + item.fact + '</td>' +
                    '<td class="alert-cell">' + item.alert + '</td>' +
                '</tr>';
            }).join('');

            var quizCount = quizCache[currentTab] ? quizCache[currentTab].length : data.data.length;

            contentArea.innerHTML =
                '<div class="section-header-bar ' + data.color + '">' +
                    '<span>' + data.title + '</span>' +
                    '<div class="header-btns">' +
                        '<button class="header-btn" onclick="openCards(0)">&#128196; Study Cards</button>' +
                        '<button class="header-btn" onclick="startQuiz()">&#129504; Quiz (' + quizCount + 'Q)</button>' +
                    '</div>' +
                '</div>' +
                '<div class="table-container">' +
                    '<table>' +
                        '<thead><tr><th>Topic</th><th>Key Point</th><th>&#9888;&#65039; Alert</th></tr></thead>' +
                        '<tbody id="table-body">' + tableRows + '</tbody>' +
                    '</table>' +
                '</div>';
        }

        window.selectRow = function(rowEl, index) {
            document.querySelectorAll('#table-body tr').forEach(function(r) { r.classList.remove('selected'); });
            rowEl.classList.add('selected');
            openCards(index);
        };

        // --- Quiz Logic ---
        window.startQuiz = function() {
            var data = contentData[currentTab];
            if (!data) return;

            // Build quiz items â€” prefer quizCache (proper quiz format), fall back to data.data
            var quizItems;
            if (quizCache[currentTab] && quizCache[currentTab].length > 0) {
                quizItems = quizCache[currentTab].map(function(qItem) {
                    return {
                        q: qItem.q,
                        a: qItem.options,
                        correct: qItem.correct,
                        rationale: qItem.rationale || ''
                    };
                });
            } else {
                quizItems = data.data.filter(function(item) {
                    return item.q && item.a;
                });
            }

            if (quizItems.length === 0) return;

            currentQuizData = shuffleArray(quizItems.slice());
            quizIndex = 0;
            quizScore = 0;
            showQuestion();
            document.getElementById('quiz-modal').style.display = 'flex';
        };

        function showQuestion() {
            var item = currentQuizData[quizIndex];
            var total = currentQuizData.length;
            document.getElementById('quiz-progress').textContent = 'Question ' + (quizIndex + 1) + ' of ' + total;
            document.getElementById('q-num-display').textContent = quizIndex + 1;
            document.getElementById('q-text').textContent = item.q;
            var fb = document.getElementById('feedback-area');
            fb.style.display = 'none';
            fb.classList.remove('is-visible');
            document.getElementById('next-btn').style.display = 'none';

            var letters = ['A', 'B', 'C', 'D'];
            var optionsHTML = item.a.map(function(opt, i) {
                return '<button class="quiz-option" onclick="checkAnswer(' + i + ', ' + item.correct + ')">' +
                    '<span class="quiz-option-letter">' + letters[i] + '</span>' +
                    '<span>' + opt + '</span>' +
                '</button>';
            }).join('');
            document.getElementById('q-options').innerHTML = optionsHTML;
        }

        window.checkAnswer = function(selected, correct) {
            var buttons = document.querySelectorAll('.quiz-option');
            buttons.forEach(function(btn, i) {
                btn.disabled = true;
                btn.style.pointerEvents = 'none';
                if (i === correct) {
                    btn.classList.add('correct-choice');
                } else if (i === selected && selected !== correct) {
                    btn.classList.add('wrong-choice');
                }
            });

            var feedbackArea = document.getElementById('feedback-area');
            var feedbackHeader = document.getElementById('feedback-header');
            var rationaleText = document.getElementById('rationale-text');
            var item = currentQuizData[quizIndex];

            if (selected === correct) {
                quizScore++;
                feedbackHeader.className = 'feedback-header correct';
                feedbackHeader.innerHTML = '&#10004;&#65039; Correct!';
                playSound('correct');
            } else {
                feedbackHeader.className = 'feedback-header incorrect';
                feedbackHeader.innerHTML = '&#10060; Incorrect';
                playSound('wrong');
            }

            rationaleText.textContent = item.rationale;
            feedbackArea.style.display = 'block';
            feedbackArea.classList.add('is-visible');
            document.getElementById('next-btn').style.display = 'block';

            if (quizIndex >= currentQuizData.length - 1) {
                document.getElementById('next-btn').textContent = 'Finish (' + quizScore + '/' + currentQuizData.length + ')';
            } else {
                document.getElementById('next-btn').textContent = 'Next Question';
            }

            setTimeout(function() {
                var nextBtn = document.getElementById('next-btn');
                if (nextBtn) {
                    nextBtn.scrollIntoView({ behavior: 'smooth', block: 'end' });
                }
            }, 100);
        };

        window.nextQuestion = function() {
            quizIndex++;
            if (quizIndex < currentQuizData.length) {
                showQuestion();
                var overlay = document.getElementById('quiz-modal');
                overlay.scrollTop = 0;
            } else {
                closeQuiz();
            }
        };

        window.closeQuiz = function() {
            document.getElementById('quiz-modal').style.display = 'none';
        };

        // --- Initial Render ---
        renderContent();

    })();
    </script>
</div>

</body>
</html>